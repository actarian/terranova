/**
 * @license more v1.0.0
 * (c) 2021 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e="progress",t="complete",n={};function o(e,n,o){if(!self.createImageBitmap||!self.OffscreenCanvas)return i(t,e,n);self.createImageBitmap(n).then((function(n){var o=n.width,r=n.height;o>r?o>320&&(r*=320/o,o=320):r>240&&(o*=240/r,r=240);var a=new OffscreenCanvas(o,r),s=a.getContext("2d");a.width=o,a.height=r,s.drawImage(n,0,0,o,r),a.convertToBlob({type:"image/jpeg",quality:.9}).then((function(n){i(t,e,n)}))}))}function i(e,t,n){self.postMessage({type:e,src:t,data:n})}self.addEventListener("message",(function(a){var s=a.data.id,f=a.data.src,l=a.data.size;if(!s||f){var u,d,c,h,v,p,g,m,y,b,w,S={mode:"cors"};if("function"==typeof fetch){if(self.AbortController){var C=new AbortController;S.signal=C.signal,n[s]=C}fetch(f,S).then((u={onProgress:function(t){i(e,f,t)}},d=u.defaultSize,c=void 0===d?0:d,h=u.emitDelay,v=void 0===h?10:h,p=u.onProgress,g=void 0===p?function(){return null}:p,m=u.onComplete,y=void 0===m?function(){return null}:m,b=u.onError,w=void 0===b?function(){return null}:b,function(e){if("undefined"==typeof Response||"undefined"==typeof ReadableStream)return e;var t=e.body,n=e.headers,o=e.status,i=n.get("content-length")||c,a=new r(i,v),s=t.getReader(),f=new ReadableStream({start:function(e){function t(){s.read().then((function(n){var o=n.done,i=n.value;if(o)return y({}),void e.close();i&&a.next(i,g),e.enqueue(i),t()})).catch((function(e){w(e)}))}t()}});return new Response(f,{headers:n,status:o})})).then((function(e){return e.blob()}),(function(e){console.log(e)})).then((function(e){delete n[s],"object"==typeof l?o(f,e):i(t,f,e)}),(function(e){console.log(e)}))}else{var D=new XMLHttpRequest;D.open("GET",f,!0),D.responseType="blob",D.withCredentials=!0,D.onload=function(){D.status<300&&("object"==typeof l?o(f,this.response):i(t,f,this.response))},D.onprogress=function(t){i(e,f,t)},D.onerror=function(){},D.send()}}else{var R=n[s];R&&R.abort()}}));var r=function(){function e(e,t){void 0===t&&(t=1e3),this.eventStart=0,this.loaded=0,this.length=parseInt(e,10)||0,this.emitDelay=t}return e.prototype.next=function(e,t){var n=e.length;(this.loaded+=n,this.eventStart=this.eventStart||Date.now(),this.length>=this.loaded||Date.now()-this.eventStart>this.emitDelay)&&(this.eventStart=Date.now(),t({total:this.length,loaded:this.loaded}))},e}()}));
//# sourceMappingURL=image.service.worker.min.js.map